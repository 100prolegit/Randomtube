<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Random YouTube Cycler (No Shorts)</title>
  <style>
    :root { color-scheme: light; }
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:#fff;
      color:#111;
      min-height:100vh;
      display:grid;
      place-items:center;
    }
    .wrap{
      width:min(1100px, 96vw);
      display:grid;
      grid-template-columns: 90px 1fr 90px;
      gap: 14px;
      align-items:center;
      padding: 18px 0;
    }
    .btn{
      height: 90px;
      width: 90px;
      border-radius: 999px;
      border: 1px solid #d0d7de;
      background: #f6f8fa;
      cursor: pointer;
      font-size: 28px;
      display:grid;
      place-items:center;
    }
    .btn:disabled{ opacity:.5; cursor:not-allowed; }
    .center{
      display:grid;
      gap:10px;
      justify-items:center;
    }
    .player{
      width: 100%;
      aspect-ratio: 16 / 9;
      background:#000;
      border-radius: 12px;
      overflow:hidden;
      border: 1px solid #d0d7de;
    }
    .status{
      font-size: 14px;
      color:#333;
      text-align:center;
      max-width: 90ch;
    }
    .mini{
      border: 1px solid #d0d7de;
      background:#fff;
      padding: 8px 10px;
      border-radius: 10px;
      cursor:pointer;
      font-weight:600;
    }
    .mini:disabled{ opacity:.6; cursor:not-allowed; }
  </style>
</head>
<body>
  <div class="wrap">
    <button class="btn" id="prevBtn" disabled>◀</button>

    <div class="center">
      <div class="player" id="player"></div>

      <div>
        <button class="mini" id="openBtn" disabled>Auf YouTube öffnen</button>
        <button class="mini" id="copyBtn" disabled>Link kopieren</button>
      </div>

      <div class="status" id="status">Lade…</div>
    </div>

    <button class="btn" id="nextBtn">▶</button>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    /***********************
     * DEIN NEUER API KEY
     ***********************/
    const YT_API_KEY = "AIzaSyDttlGaemvXru1QrJgrzrTvnJROj9E8HCQ";

    const RANDOM_WORDS = [
      "piano","volcano","origami","interview","street","forest","train","ocean",
      "chess","repair","history","physics","architecture","cooking","design",
      "robot","painting","math","jazz","documentary","cat","dog","travel","sports",
      "gaming","comedy","science","education","brazil","india","japan","korea"
    ];

    const CATEGORIES = [1,2,10,15,17,19,20,22,23,24,25,26,27,28];
    const SAFE_SEARCH = "moderate";
    const MIN_SECONDS = 60;

    let player;
    let currentVideoId = null;
    const backStack = [];

    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const statusEl = document.getElementById("status");
    const openBtn = document.getElementById("openBtn");
    const copyBtn = document.getElementById("copyBtn");

    function setStatus(t){ statusEl.textContent = t; }
    function pick(arr){ return arr[Math.floor(Math.random() * arr.length)]; }

    function isoDurationToSeconds(iso){
      const m = /^PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?$/.exec(iso || "");
      if (!m) return 0;
      return (parseInt(m[1]||0)*3600)+(parseInt(m[2]||0)*60)+(parseInt(m[3]||0));
    }

    async function ytSearch(){
      const q = `${pick(RANDOM_WORDS)} ${Math.floor(Math.random()*100000)} ${pick(RANDOM_WORDS)}`;
      const url = new URL("https://www.googleapis.com/youtube/v3/search");
      url.searchParams.set("key", YT_API_KEY);
      url.searchParams.set("part", "snippet");
      url.searchParams.set("type", "video");
      url.searchParams.set("maxResults", "25");
      url.searchParams.set("q", q);
      url.searchParams.set("videoCategoryId", pick(CATEGORIES));
      url.searchParams.set("safeSearch", SAFE_SEARCH);
      url.searchParams.set("videoEmbeddable", "true");
      url.searchParams.set("videoSyndicated", "true");

      const res = await fetch(url);
      const data = await res.json();
      return (data.items || []).map(it => it.id.videoId);
    }

    async function filterNoShorts(ids){
      const url = new URL("https://www.googleapis.com/youtube/v3/videos");
      url.searchParams.set("key", YT_API_KEY);
      url.searchParams.set("part", "contentDetails,status");
      url.searchParams.set("id", ids.join(","));

      const res = await fetch(url);
      const data = await res.json();

      return (data.items || [])
        .filter(v => v.status.embeddable && isoDurationToSeconds(v.contentDetails.duration) >= MIN_SECONDS)
        .map(v => v.id);
    }

    async function loadRandom(){
      setStatus("Suche zufälliges Video...");
      nextBtn.disabled = true;

      try{
        for(let i=0;i<6;i++){
          const ids = await ytSearch();
          const filtered = await filterNoShorts(ids);
          if(filtered.length){
            const vid = pick(filtered);
            if(currentVideoId) backStack.push(currentVideoId);
            currentVideoId = vid;
            player.loadVideoById(vid);
            prevBtn.disabled = backStack.length === 0;

            const url = `https://www.youtube.com/watch?v=${vid}`;
            openBtn.disabled = false;
            copyBtn.disabled = false;
            openBtn.onclick = ()=>window.open(url,"_blank");
            copyBtn.onclick = ()=>navigator.clipboard.writeText(url);

            setStatus("Video geladen");
            break;
          }
        }
      }catch(e){
        setStatus("Fehler: "+e.message);
      }

      nextBtn.disabled = false;
    }

    function goBack(){
      if(!backStack.length) return;
      const vid = backStack.pop();
      currentVideoId = vid;
      player.loadVideoById(vid);
      prevBtn.disabled = backStack.length === 0;
    }

    prevBtn.addEventListener("click", goBack);
    nextBtn.addEventListener("click", loadRandom);

    function onYouTubeIframeAPIReady(){
      player = new YT.Player("player",{
        host:"https://www.youtube-nocookie.com",
        width:"100%",
        height:"100%",
        playerVars:{autoplay:1,rel:0},
        events:{ onReady: loadRandom }
      });
    }
    window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
  </script>
</body>
</html>
